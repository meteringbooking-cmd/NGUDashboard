<!DOCTYPE html> 
 <html lang="en"> 
 <head> 
 Â  Â  <meta charset="UTF-8"> 
 Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
 Â  Â  <title>Engineer Dashboard</title> 
 Â  Â  <style> 
 Â  Â  Â  Â  * { 
 Â  Â  Â  Â  Â  Â  margin: 0; 
 Â  Â  Â  Â  Â  Â  padding: 0; 
 Â  Â  Â  Â  Â  Â  box-sizing: border-box; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  body { 
 Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
 Â  Â  Â  Â  Â  Â  background-color: #f5f7fa; 
 Â  Â  Â  Â  Â  Â  color: #333; 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  justify-content: center; 
 Â  Â  Â  Â  Â  Â  min-height: 100vh; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .container { 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  max-width: 900px; 
 Â  Â  Â  Â  Â  Â  padding: 20px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  /* --- Login Screen --- */ 
 Â  Â  Â  Â  #loginScreen { 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  padding: 40px; 
 Â  Â  Â  Â  Â  Â  border-radius: 12px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  max-width: 400px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  #loginScreen h1 { 
 Â  Â  Â  Â  Â  Â  color: #667eea; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 20px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .login-form input { 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  padding: 12px 15px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  border: 1px solid #e0e6ed; 
 Â  Â  Â  Â  Â  Â  font-size: 16px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  #loginScreen button { 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  padding: 12px 20px; 
 Â  Â  Â  Â  Â  Â  border: none; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  font-size: 16px; 
 Â  Â  Â  Â  Â  Â  background: #667eea; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  transition: background 0.3s ease; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  #loginScreen button:hover { 
 Â  Â  Â  Â  Â  Â  background: #5a66e4; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  #loginError { 
 Â  Â  Â  Â  Â  Â  color: #e84393; 
 Â  Â  Â  Â  Â  Â  margin-top: 10px; 
 Â  Â  Â  Â  Â  Â  font-size: 0.9em; 
 Â  Â  Â  Â  Â  Â  visibility: hidden; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  /* --- Images below login --- */ 
 Â  Â  Â  Â  .login-images { 
 Â  Â  Â  Â  Â  Â  margin-top: 30px; 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  flex-direction: column; 
 Â  Â  Â  Â  Â  Â  gap: 20px; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .login-images img { 
 Â  Â  Â  Â  Â  Â  max-width: 100%; 
 Â  Â  Â  Â  Â  Â  height: auto; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .login-images .screenshot-img { 
 Â  Â  Â  Â  Â  Â  max-height: 200px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .login-images .stark-img { 
 Â  Â  Â  Â  Â  Â  max-height: 150px; 
 Â  Â  Â  Â  Â  Â  max-width: 150px; 
 Â  Â  Â  Â  Â  Â  border-radius: 50%; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  /* --- Dashboard Screen --- */ 
 Â  Â  Â  Â  #dashboardScreen { 
 Â  Â  Â  Â  Â  Â  display: none; 
 Â  Â  Â  Â  Â  Â  flex-direction: column; 
 Â  Â  Â  Â  Â  Â  gap: 20px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .dashboard-header { 
 Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  Â  Â  padding: 20px; 
 Â  Â  Â  Â  Â  Â  border-radius: 12px; 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  justify-content: space-between; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  Â  Â  flex-wrap: wrap; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .dashboard-header h1 { 
 Â  Â  Â  Â  Â  Â  font-size: 1.5em; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .jobs-area { 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  border-radius: 12px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
 Â  Â  Â  Â  Â  Â  padding: 20px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card { 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  border: 2px solid #e0e6ed; 
 Â  Â  Â  Â  Â  Â  border-radius: 12px; 
 Â  Â  Â  Â  Â  Â  padding: 15px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  transition: all 0.3s ease; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card:hover { 
 Â  Â  Â  Â  Â  Â  transform: translateY(-3px); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 20px rgba(0,0,0,0.15); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card.on-route { 
 Â  Â  Â  Â  Â  Â  border-color: #fdcb6e; 
 Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #fff9e6 0%, #fef5d3 100%); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card.in-progress { 
 Â  Â  Â  Â  Â  Â  border-color: #74b9ff; 
 Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #e6f3ff 0%, #d1ecff 100%); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card.completed { 
 Â  Â  Â  Â  Â  Â  border-color: #00b894; 
 Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #e6fff9 0%, #d1ffed 100%); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card.cancelled { 
 Â  Â  Â  Â  Â  Â  border-color: #636e72; 
 Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #f1f2f6 0%, #e8eaed 100%); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-card.aborted { 
 Â  Â  Â  Â  Â  Â  border-color: #e84393; 
 Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #ffe6f1 0%, #ffd3e8 100%); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-header { 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  justify-content: space-between; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 10px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-ref { 
 Â  Â  Â  Â  Â  Â  font-weight: bold; 
 Â  Â  Â  Â  Â  Â  font-size: 1.1em; 
 Â  Â  Â  Â  Â  Â  color: #2d3436; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-status { 
 Â  Â  Â  Â  Â  Â  padding: 4px 8px; 
 Â  Â  Â  Â  Â  Â  border-radius: 20px; 
 Â  Â  Â  Â  Â  Â  font-size: 0.8em; 
 Â  Â  Â  Â  Â  Â  font-weight: 600; 
 Â  Â  Â  Â  Â  Â  text-transform: uppercase; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-status.on-route { background: #fdcb6e; color: #2d3436; } 
 Â  Â  Â  Â  .job-status.in-progress { background: #74b9ff; color: white; } 
 Â  Â  Â  Â  .job-status.completed { background: #00b894; color: white; } 
 Â  Â  Â  Â  .job-status.cancelled { background: #636e72; color: white; } 
 Â  Â  Â  Â  .job-status.aborted { background: #e84393; color: white; } 

 Â  Â  Â  Â  .job-details { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 10px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-detail { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 5px; 
 Â  Â  Â  Â  Â  Â  font-size: 0.9em; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .job-detail strong { 
 Â  Â  Â  Â  Â  Â  color: #2d3436; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .masked-call-button { 
 Â  Â  Â  Â  Â  Â  display: inline-block; 
 Â  Â  Â  Â  Â  Â  padding: 8px 12px; 
 Â  Â  Â  Â  Â  Â  font-size: 0.9em; 
 Â  Â  Â  Â  Â  Â  font-weight: 600; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  Â  Â  background: #00b894; 
 Â  Â  Â  Â  Â  Â  border: none; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  transition: background 0.3s ease; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .masked-call-button:hover { 
 Â  Â  Â  Â  Â  Â  background: #009a7b; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .jobs-area h2 { 
 Â  Â  Â  Â  Â  Â  margin-top: 20px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 10px; 
 Â  Â  Â  Â  Â  Â  font-size: 1.3em; 
 Â  Â  Â  Â  Â  Â  color: #667eea; 
 Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #e0e6ed; 
 Â  Â  Â  Â  Â  Â  padding-bottom: 5px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .jobs-area h2:first-of-type { 
 Â  Â  Â  Â  Â  Â  margin-top: 0; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .status-menu { 
 Â  Â  Â  Â  Â  Â  position: absolute; 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 25px rgba(0,0,0,0.2); 
 Â  Â  Â  Â  Â  Â  padding: 10px; 
 Â  Â  Â  Â  Â  Â  z-index: 1000; 
 Â  Â  Â  Â  Â  Â  border: 1px solid #e0e6ed; 
 Â  Â  Â  Â  Â  Â  display: none; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .status-option { 
 Â  Â  Â  Â  Â  Â  padding: 8px 15px; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  border-radius: 6px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 5px; 
 Â  Â  Â  Â  Â  Â  transition: background 0.2s ease; 
 Â  Â  Â  Â  Â  Â  font-size: 0.9em; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .status-option:hover { 
 Â  Â  Â  Â  Â  Â  background: #f8f9ff; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .status-option:last-child { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 0; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .loading { 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  Â  Â  padding: 40px; 
 Â  Â  Â  Â  Â  Â  font-size: 1.1em; 
 Â  Â  Â  Â  Â  Â  color: #636e72; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .no-jobs { 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  Â  Â  padding: 40px; 
 Â  Â  Â  Â  Â  Â  color: #636e72; 
 Â  Â  Â  Â  Â  Â  font-style: italic; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .no-jobs-section { 
 Â  Â  Â  Â  Â  Â  padding: 10px 0; 
 Â  Â  Â  Â  Â  Â  color: #636e72; 
 Â  Â  Â  Â  Â  Â  font-style: italic; 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* --- Comment Modal Styles --- */ 
 Â  Â  Â  Â  .modal { 
 Â  Â  Â  Â  Â  Â  display: none; /* Hidden by default */ 
 Â  Â  Â  Â  Â  Â  position: fixed; /* Stay in place */ 
 Â  Â  Â  Â  Â  Â  z-index: 2000; /* Sit on top */ 
 Â  Â  Â  Â  Â  Â  left: 0; 
 Â  Â  Â  Â  Â  Â  top: 0; 
 Â  Â  Â  Â  Â  Â  width: 100%; /* Full width */ 
 Â  Â  Â  Â  Â  Â  height: 100%; /* Full height */ 
 Â  Â  Â  Â  Â  Â  overflow: auto; /* Enable scroll if needed */ 
 Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */ 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  Â  Â  justify-content: center; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .modal-content { 
 Â  Â  Â  Â  Â  Â  background-color: #fefefe; 
 Â  Â  Â  Â  Â  Â  padding: 30px; 
 Â  Â  Â  Â  Â  Â  border: 1px solid #888; 
 Â  Â  Â  Â  Â  Â  width: 90%; 
 Â  Â  Â  Â  Â  Â  max-width: 500px; 
 Â  Â  Â  Â  Â  Â  border-radius: 12px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.2); 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .modal-content h2 { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 20px; 
 Â  Â  Â  Â  Â  Â  color: #667eea; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .modal-content textarea { 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  height: 120px; 
 Â  Â  Â  Â  Â  Â  padding: 10px; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  border: 1px solid #e0e6ed; 
 Â  Â  Â  Â  Â  Â  resize: vertical; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
 Â  Â  Â  Â  Â  Â  font-size: 1em; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .modal-buttons { 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  justify-content: center; 
 Â  Â  Â  Â  Â  Â  gap: 10px; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  .modal-buttons button { 
 Â  Â  Â  Â  Â  Â  padding: 10px 20px; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  font-size: 1em; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  border: none; 
 Â  Â  Â  Â  Â  Â  transition: background 0.3s ease; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  #submitCommentBtn { 
 Â  Â  Â  Â  Â  Â  background-color: #667eea; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  #submitCommentBtn:hover { 
 Â  Â  Â  Â  Â  Â  background-color: #5a66e4; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  #cancelCommentBtn { 
 Â  Â  Â  Â  Â  Â  background-color: #e0e6ed; 
 Â  Â  Â  Â  Â  Â  color: #333; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  #cancelCommentBtn:hover { 
 Â  Â  Â  Â  Â  Â  background-color: #cfd4db; 
 Â  Â  Â  Â  } 
 Â  Â  </style> 
 </head> 
 <body> 
 Â  Â  <div class="container"> 
 Â  Â  Â  Â  <div id="loginScreen"> 
 Â  Â  Â  Â  Â  Â  <h1>Login</h1> 
 Â  Â  Â  Â  Â  Â  <form class="login-form" id="loginForm"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="username" placeholder="Username" required> 
 Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="password" placeholder="Password" required> 
 Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Login</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  <p id="loginError">Invalid username or password.</p> 
 Â  Â  Â  Â  Â  Â  </form> 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  <div class="login-images"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://www.dropbox.com/scl/fi/4eilt1ka4obatkaif4ksg/Screenshot-2025-06-11-132304.png?rlkey=1puz3m5i205n2t4q9n6srfq56&st=00ujjvmz&dl=1" alt="Screenshot" class="screenshot-img"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <img src="https://www.dropbox.com/scl/fi/67vmxu3kngvgkm1mf5tcp/Stark.jpg?rlkey=5gz9fhspn3t1aiu03ksob3r2c&st=8ppqfpwr&dl=1" alt="Stark" class="stark-img"> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  </div> 

 Â  Â  Â  Â  <div id="dashboardScreen"> 
 Â  Â  Â  Â  Â  Â  <div class="dashboard-header"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="engineerNameHeader">Engineer Dashboard</h1> 
 Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="dateFilter"> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  <div class="jobs-area" id="jobsContainer"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="loading">Select an engineer to view jobs...</div> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  </div> 
 Â  Â  </div> 

 Â  Â  <div id="statusMenu" class="status-menu"> 
 Â  Â  Â  Â  <div class="status-option" data-status="On Route">ğŸš— On Route</div> 
 Â  Â  Â  Â  <div class="status-option" data-status="In Progress">ğŸ”§ In Progress</div> 
 Â  Â  Â  Â  <div class="status-option" data-status="Completed">âœ… Completed</div> 
 Â  Â  Â  Â  <div class="status-option" data-status="Cancelled">âŒ Cancelled</div> 
 Â  Â  Â  Â  <div class="status-option" data-status="Aborted">âš ï¸ Aborted</div> 
 Â  Â  </div> 

 Â  Â  <div id="commentModal" class="modal"> 
 Â  Â  Â  Â  <div class="modal-content"> 
 Â  Â  Â  Â  Â  Â  <h2 id="commentModalTitle"></h2> 
 Â  Â  Â  Â  Â  Â  <textarea id="commentTextarea" placeholder="Enter reason here..."></textarea> 
 Â  Â  Â  Â  Â  Â  <div class="modal-buttons"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <button id="submitCommentBtn">Submit</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  <button id="cancelCommentBtn">Cancel</button> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  </div> 
 Â  Â  </div> 

 Â  Â  <script> 
 Â  Â  Â  Â  // REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL 
 Â  Â  Â  Â  const API_URL = 'https://script.google.com/macros/s/AKfycbyMSAcn2r9UOeJ_TmiU3Oz0QCXxBtFX5dy29gZxqWdLsUVWwRSN4zT4T_ootEvjBZWj/exec'; 

 Â  Â  Â  Â  let allJobs = []; 
 Â  Â  Â  Â  let authData = []; 
 Â  Â  Â  Â  let selectedEngineer = ''; 
 Â  Â  Â  Â  let currentJobCard = null; 
 Â  Â  Â  Â  let pendingStatusUpdate = null; 

 Â  Â  Â  Â  async function init() { 
 Â  Â  Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0]; 
 Â  Â  Â  Â  Â  Â  document.getElementById('dateFilter').value = today; 

 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // Fetch the list of users and passwords first 
 Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${API_URL}?action=getAuthData`); 
 Â  Â  Â  Â  Â  Â  Â  Â  authData = await response.json(); 
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error loading auth data:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loginError').textContent = 'Error loading user data.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loginError').style.visibility = 'visible'; 
 Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  setupEventListeners(); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function setupEventListeners() { 
 Â  Â  Â  Â  Â  Â  document.getElementById('loginForm').addEventListener('submit', handleLogin); 
 Â  Â  Â  Â  Â  Â  document.getElementById('dateFilter').addEventListener('change', handleDateChange); 

 Â  Â  Â  Â  Â  Â  // Event listeners for the new modal 
 Â  Â  Â  Â  Â  Â  document.getElementById('submitCommentBtn').addEventListener('click', submitWithComment); 
 Â  Â  Â  Â  Â  Â  document.getElementById('cancelCommentBtn').addEventListener('click', closeCommentModal); 

 Â  Â  Â  Â  Â  Â  document.addEventListener('click', (e) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  const statusMenu = document.getElementById('statusMenu'); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (!statusMenu.contains(e.target) && !e.target.closest('.job-card')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMenu.style.display = 'none'; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  async function handleLogin(e) { 
 Â  Â  Â  Â  Â  Â  e.preventDefault(); 
 Â  Â  Â  Â  Â  Â  const usernameInput = document.getElementById('username').value; 
 Â  Â  Â  Â  Â  Â  const passwordInput = document.getElementById('password').value; 
 Â  Â  Â  Â  Â  Â  const errorElement = document.getElementById('loginError'); 

 Â  Â  Â  Â  Â  Â  const user = authData.find(u => u.Engineer === usernameInput && u.Password === passwordInput); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (user) { 
 Â  Â  Â  Â  Â  Â  Â  Â  selectedEngineer = user.Engineer; 
 Â  Â  Â  Â  Â  Â  Â  Â  errorElement.style.visibility = 'hidden'; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loginScreen').style.display = 'none'; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dashboardScreen').style.display = 'flex'; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('engineerNameHeader').textContent = `${selectedEngineer}'s Dashboard`; 
 Â  Â  Â  Â  Â  Â  Â  Â  await loadJobs(); 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  errorElement.style.visibility = 'visible'; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  async function loadJobs() { 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // Now fetch the actual job data 
 Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${API_URL}?action=getJobs`); 
 Â  Â  Â  Â  Â  Â  Â  Â  allJobs = await response.json(); 
 Â  Â  Â  Â  Â  Â  Â  Â  displayJobsForEngineer(); 
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error loading jobs:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('jobsContainer').innerHTML = '<div class="no-jobs">Error loading jobs. Please check your API URL.</div>'; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function handleDateChange(e) { 
 Â  Â  Â  Â  Â  Â  displayJobsForEngineer(); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function displayJobsForEngineer() { 
 Â  Â  Â  Â  Â  Â  const jobsContainer = document.getElementById('jobsContainer'); 
 Â  Â  Â  Â  Â  Â  const selectedDate = new Date(document.getElementById('dateFilter').value); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // Extract day, month, year from the selected date 
 Â  Â  Â  Â  Â  Â  const selectedDay = selectedDate.getDate(); 
 Â  Â  Â  Â  Â  Â  const selectedMonth = selectedDate.getMonth() + 1; // JavaScript months are 0-indexed 
 Â  Â  Â  Â  Â  Â  const selectedYear = selectedDate.getFullYear(); 

 Â  Â  Â  Â  Â  Â  console.log('Filtering for:', { selectedDay, selectedMonth, selectedYear }); 

 Â  Â  Â  Â  Â  Â  const filteredJobs = allJobs.filter(job => { 
 Â  Â  Â  Â  Â  Â  Â  Â  if (job.Engineer !== selectedEngineer) return false; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // Parse the separate day, month, year columns 
 Â  Â  Â  Â  Â  Â  Â  Â  const jobDay = parseInt(job.Day); 
 Â  Â  Â  Â  Â  Â  Â  Â  const jobMonth = parseInt(job.Month); 
 Â  Â  Â  Â  Â  Â  Â  Â  const jobYear = parseInt(job.Year); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('Job date components:', { jobDay, jobMonth, jobYear, ref: job.Ref }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  return jobDay === selectedDay && jobMonth === selectedMonth && jobYear === selectedYear; 
 Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  console.log(`Found ${filteredJobs.length} jobs for ${selectedEngineer} on ${selectedDay}/${selectedMonth}/${selectedYear}`); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (filteredJobs.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  jobsContainer.innerHTML = '<div class="no-jobs">No jobs scheduled for this date.</div>'; 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  let amJobs = filteredJobs.filter(job => job.Time && job.Time.toUpperCase().includes('AM')); 
 Â  Â  Â  Â  Â  Â  Â  Â  let pmJobs = filteredJobs.filter(job => job.Time && job.Time.toUpperCase().includes('PM')); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // Sort jobs within each section 
 Â  Â  Â  Â  Â  Â  Â  Â  const sortJobsByTime = (a, b) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeA = new Date(`2000/01/01 ${a.Time}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeB = new Date(`2000/01/01 ${b.Time}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return timeA - timeB; 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 

 Â  Â  Â  Â  Â  Â  Â  Â  amJobs.sort(sortJobsByTime); 
 Â  Â  Â  Â  Â  Â  Â  Â  pmJobs.sort(sortJobsByTime); 

 Â  Â  Â  Â  Â  Â  Â  Â  let html = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â  if (amJobs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += '<h2>AM Jobs</h2>' + amJobs.map(createJobCard).join(''); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += '<h2>AM Jobs</h2><div class="no-jobs-section">No AM jobs.</div>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  if (pmJobs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += '<h2>PM Jobs</h2>' + pmJobs.map(createJobCard).join(''); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += '<h2>PM Jobs</h2><div class="no-jobs-section">No PM jobs.</div>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  jobsContainer.innerHTML = html; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  jobsContainer.querySelectorAll('.job-card').forEach(card => { 
 Â  Â  Â  Â  Â  Â  Â  Â  card.addEventListener('click', handleJobCardClick); 
 Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function createJobCard(job) { 
 Â  Â  Â  Â  Â  Â  const statusClass = job.Status ? job.Status.toLowerCase().replace(' ', '-') : ''; 
 Â  Â  Â  Â  Â  Â  const statusDisplay = job.Status || 'Pending'; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  return ` 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-card ${statusClass}" data-ref="${job.Ref}" data-phone="${job['Appointment Contact Number'] || ''}"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-header"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-ref">Job #${job.Ref}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-status ${statusClass}">${statusDisplay}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-details"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-detail"><strong>Customer:</strong> ${job['Appointment Contact Name'] || 'N/A'}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-detail"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>Phone:</strong>Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="masked-call-button" onclick="handleMaskedCall(this)">Masked Call</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-detail"><strong>Address:</strong> ${job.Address || 'N/A'}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-detail"><strong>Postcode:</strong> ${job['Job Details : Postcode'] || 'N/A'}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="job-detail"><strong>Time:</strong> ${job.Time || 'N/A'}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  async function handleMaskedCall(button) { 
 Â  Â  Â  Â  Â  Â  const jobCard = button.closest('.job-card'); 
 Â  Â  Â  Â  Â  Â  const customerPhone = jobCard.dataset.phone; 
 Â  Â  Â  Â  Â  Â  const jobRef = jobCard.dataset.ref; 
 Â  Â  Â  Â  Â  Â  const engineerPhone = selectedEngineer; // This will likely be the engineer's username from login, you may need a lookup table in your Google Sheet to get the actual phone number. 

 Â  Â  Â  Â  Â  Â  if (!customerPhone || customerPhone === 'N/A') { 
 Â  Â  Â  Â  Â  Â  Â  Â  alert('Customer phone number is not available.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  console.log(`Initiating masked call for Job #${jobRef} from engineer ${engineerPhone} to customer at ${customerPhone}`); 

 Â  Â  Â  Â  Â  Â  // A placeholder to show a "calling" state 
 Â  Â  Â  Â  Â  Â  button.textContent = 'Calling...'; 
 Â  Â  Â  Â  Â  Â  button.disabled = true; 

 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  const payload = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: "maskedCall", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customerPhone: customerPhone, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  engineerPhone: engineerPhone 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_URL, { Â  Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'text/plain;charset=utf-8' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload) 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json(); 

 Â  Â  Â  Â  Â  Â  Â  Â  if (result.success) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('Call initiated successfully. Your engineer will receive a call from a Twilio number shortly, connecting them to the customer.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Failed to initiate call: ${result.message}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } catch (error) { Â  Â  
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error initiating masked call:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert('An error occurred. Please check the console for details.'); 
 Â  Â  Â  Â  Â  Â  } finally { 
 Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'Masked Call'; 
 Â  Â  Â  Â  Â  Â  Â  Â  button.disabled = false; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function handleJobCardClick(e) { 
 Â  Â  Â  Â  Â  Â  // Check if the click was on the masked call button, if so, do nothing 
 Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('masked-call-button')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  e.stopPropagation(); 
 Â  Â  Â  Â  Â  Â  currentJobCard = e.currentTarget; 
 Â  Â  Â  Â  Â  Â  const rect = currentJobCard.getBoundingClientRect(); 
 Â  Â  Â  Â  Â  Â  const statusMenu = document.getElementById('statusMenu'); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  statusMenu.style.display = 'block'; 
 Â  Â  Â  Â  Â  Â  statusMenu.style.left = rect.left + 'px'; 
 Â  Â  Â  Â  Â  Â  statusMenu.style.top = (rect.bottom + 5) + 'px'; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  statusMenu.querySelectorAll('.status-option').forEach(option => { 
 Â  Â  Â  Â  Â  Â  Â  Â  option.onclick = () => updateJobStatus(option.dataset.status); 
 Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  async function updateJobStatus(newStatus) { 
 Â  Â  Â  Â  Â  Â  if (!currentJobCard) return; 

 Â  Â  Â  Â  Â  Â  const statusMenu = document.getElementById('statusMenu'); 
 Â  Â  Â  Â  Â  Â  statusMenu.style.display = 'none'; 

 Â  Â  Â  Â  Â  Â  // Check if the status requires a comment 
 Â  Â  Â  Â  Â  Â  if (newStatus === 'Cancelled' || newStatus === 'Aborted') { 
 Â  Â  Â  Â  Â  Â  Â  Â  showCommentModal(newStatus); 
 Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  // Regular status update without comment 
 Â  Â  Â  Â  Â  Â  const jobRef = currentJobCard.dataset.ref; 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`Updating job ${jobRef} to status: ${newStatus}`); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const payload = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: "updateJob", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ref: jobRef, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Status: newStatus 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 

 Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_URL, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'text/plain;charset=utf-8' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload) 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (result.success) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const job = allJobs.find(j => j.Ref == jobRef); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (job) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  job.Status = newStatus; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statusClass = newStatus.toLowerCase().replace(' ', '-'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentJobCard.className = 'job-card ' + statusClass; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentJobCard.querySelector('.job-status').textContent = newStatus; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentJobCard.querySelector('.job-status').className = 'job-status ' + statusClass; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Job updated successfully'); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(result.message || 'Unknown error occurred'); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error updating job status:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert(`Failed to update job status: ${error.message}. Please check the console for details.`); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function showCommentModal(status) { 
 Â  Â  Â  Â  Â  Â  const modal = document.getElementById('commentModal'); 
 Â  Â  Â  Â  Â  Â  const title = document.getElementById('commentModalTitle'); 
 Â  Â  Â  Â  Â  Â  const textarea = document.getElementById('commentTextarea'); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  title.textContent = `Please provide a reason for ${status.toLowerCase()}:`; 
 Â  Â  Â  Â  Â  Â  textarea.value = ''; 
 Â  Â  Â  Â  Â  Â  textarea.focus(); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  pendingStatusUpdate = status; 
 Â  Â  Â  Â  Â  Â  modal.style.display = 'flex'; // Use flex to center the modal 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  function closeCommentModal() { 
 Â  Â  Â  Â  Â  Â  const modal = document.getElementById('commentModal'); 
 Â  Â  Â  Â  Â  Â  modal.style.display = 'none'; 
 Â  Â  Â  Â  Â  Â  pendingStatusUpdate = null; 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  async function submitWithComment() { 
 Â  Â  Â  Â  Â  Â  const comment = document.getElementById('commentTextarea').value.trim(); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (!comment) { 
 Â  Â  Â  Â  Â  Â  Â  Â  alert('Please provide a reason before submitting.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  if (!currentJobCard || !pendingStatusUpdate) return; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  const jobRef = currentJobCard.dataset.ref; 
 Â  Â  Â  Â  Â  Â  closeCommentModal(); 

 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`Updating job ${jobRef} to status: ${pendingStatusUpdate} with comment: ${comment}`); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const payload = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: "updateJob", 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ref: jobRef, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Status: pendingStatusUpdate, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Comments: comment 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 

 Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_URL, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'text/plain;charset=utf-8' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload) 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (result.success) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const job = allJobs.find(j => j.Ref == jobRef); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (job) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  job.Status = pendingStatusUpdate; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  job.Comments = comment; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statusClass = pendingStatusUpdate.toLowerCase().replace(' ', '-'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentJobCard.className = 'job-card ' + statusClass; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentJobCard.querySelector('.job-status').textContent = pendingStatusUpdate; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentJobCard.querySelector('.job-status').className = 'job-status ' + statusClass; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Job updated successfully with comment'); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(result.message || 'Unknown error occurred'); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error updating job status:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert(`Failed to update job status: ${error.message}. Please check the console for details.`); 
 Â  Â  Â  Â  Â  Â  } finally { 
 Â  Â  Â  Â  Â  Â  Â  Â  pendingStatusUpdate = null; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  // Close modal when clicking outside of it 
 Â  Â  Â  Â  window.onclick = function(event) { 
 Â  Â  Â  Â  Â  Â  const modal = document.getElementById('commentModal'); 
 Â  Â  Â  Â  Â  Â  if (event.target === modal) { 
 Â  Â  Â  Â  Â  Â  Â  Â  closeCommentModal(); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 

 Â  Â  Â  Â  window.addEventListener('load', init); 
 Â  Â  </script> 
 </body> 
 </html>
